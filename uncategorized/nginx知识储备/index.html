<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Nginx知识储备 - pm123&#039;s blog</title><link rel="manifest" href="/blog/manifest.json"><meta name="application-name" content="pm123&#039;s blog"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="pm123&#039;s blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="location 匹配顺序&amp;#x3D; 开头表示精确匹配 ,如 location &amp;#x3D; &amp;#x2F; &amp;amp;#123;&amp;amp;#125; 中只匹配根目录结尾的请求，后面不能带任何字符串; ^~ 开头表示uri以某个常规字符串开头，不是正则匹配; &amp;lt;匹配符合以后，停止往下搜索正则，采用这一条&amp;gt;f ~ 开头表示区分大小写的正则匹配; ~* 开头表示不区分大小写的正则匹配; &amp;#x2F; 通用匹配, 如果没有其它匹配,任何请求都会匹"><meta property="og:type" content="blog"><meta property="og:title" content="Nginx知识储备"><meta property="og:url" content="https://pm123.github.io/blog/uncategorized/nginx%E7%9F%A5%E8%AF%86%E5%82%A8%E5%A4%87/"><meta property="og:site_name" content="pm123&#039;s blog"><meta property="og:description" content="location 匹配顺序&amp;#x3D; 开头表示精确匹配 ,如 location &amp;#x3D; &amp;#x2F; &amp;amp;#123;&amp;amp;#125; 中只匹配根目录结尾的请求，后面不能带任何字符串; ^~ 开头表示uri以某个常规字符串开头，不是正则匹配; &amp;lt;匹配符合以后，停止往下搜索正则，采用这一条&amp;gt;f ~ 开头表示区分大小写的正则匹配; ~* 开头表示不区分大小写的正则匹配; &amp;#x2F; 通用匹配, 如果没有其它匹配,任何请求都会匹"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://pm123.github.io/blog/img/og_image.png"><meta property="article:published_time" content="2022-08-23T02:22:53.000Z"><meta property="article:modified_time" content="2022-08-23T02:24:38.175Z"><meta property="article:author" content="pm123"><meta property="article:tag" content="前端"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/blog/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://pm123.github.io/blog/uncategorized/nginx%E7%9F%A5%E8%AF%86%E5%82%A8%E5%A4%87/"},"headline":"Nginx知识储备","image":["https://pm123.github.io/blog/img/og_image.png"],"datePublished":"2022-08-23T02:22:53.000Z","dateModified":"2022-08-23T02:24:38.175Z","author":{"@type":"Person","name":"pm123"},"publisher":{"@type":"Organization","name":"pm123's blog","logo":{"@type":"ImageObject","url":"https://pm123.github.io/img/logo.svg"}},"description":"location 匹配顺序&#x3D; 开头表示精确匹配 ,如 location &#x3D; &#x2F; &amp;#123;&amp;#125; 中只匹配根目录结尾的请求，后面不能带任何字符串; ^~ 开头表示uri以某个常规字符串开头，不是正则匹配; &lt;匹配符合以后，停止往下搜索正则，采用这一条&gt;f ~ 开头表示区分大小写的正则匹配; ~* 开头表示不区分大小写的正则匹配; &#x2F; 通用匹配, 如果没有其它匹配,任何请求都会匹"}</script><link rel="canonical" href="https://pm123.github.io/blog/uncategorized/nginx%E7%9F%A5%E8%AF%86%E5%82%A8%E5%A4%87/"><link rel="icon" href="/blog/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/blog/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 6.1.0"></head><body class="is-1-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/blog/"><img src="/blog/img/logo.svg" alt="pm123&#039;s blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/blog/">首页</a><a class="navbar-item" href="/blog/archives">活动</a><a class="navbar-item" href="/blog/categories">分类</a><a class="navbar-item" href="/blog/tags">标签</a><a class="navbar-item" href="/blog/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Author&#039;s GitHub" href="https://github.com/pm123"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-12"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-08-23T02:22:53.000Z" title="2022/8/23 上午10:22:53">2022-08-23</time>发表</span><span class="level-item"><time dateTime="2022-08-23T02:24:38.175Z" title="2022/8/23 上午10:24:38">2022-08-23</time>更新</span><span class="level-item">9 分钟读完 (大约1287个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">Nginx知识储备</h1><div class="content"><h4 id="location-匹配顺序"><a href="#location-匹配顺序" class="headerlink" title="location 匹配顺序"></a>location 匹配顺序</h4><p><code>=</code> 开头表示精确匹配 ,如 <code>location = / &#123;&#125; </code>中只匹配根目录结尾的请求，后面不能带任何字符串;</p>
<p><code>^~</code> 开头表示uri以某个常规字符串开头，不是正则匹配; &lt;匹配符合以后，停止往下搜索正则，采用这一条&gt;f</p>
<p><code>~</code> 开头表示区分大小写的正则匹配;</p>
<p><code>~*</code> 开头表示不区分大小写的正则匹配;</p>
<p><code>/</code> 通用匹配, 如果没有其它匹配,任何请求都会匹配到;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">正则location和普通location</span><br><span class="line"></span><br><span class="line">正则location  “~”和“~*”：“~”表示区分大小写；“~*”表示不区分大小写</span><br><span class="line"></span><br><span class="line">普通location:  除了上面其余全是(包括没有前缀) “=”，“^~”，“@”</span><br><span class="line"></span><br><span class="line">“^~”中的“^”表示非，“~”表示正则，意思为不要继续匹配正则</span><br><span class="line"></span><br><span class="line">“=”也表示阻止正则location，和“^~”的区别为：“^~”依然遵守“最大前缀”匹配；而“=”必须是严格匹配。</span><br><span class="line"></span><br><span class="line">“@ ”是用来定义“Named Location ”的（可以理解为独立于“普通location”和“正则location”之外的第三种类型），这种“Named Location ”不是用来处理普通的HTTP 请求的，它是专门用来处理“内部重定向（internally redirected ）”请求的。</span><br><span class="line"></span><br><span class="line">注意：这里说的“内部重定向（internally redirected ）”是不需要跟浏览器交互的，纯粹是服务端的一个转发行为。</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.匹配的顺序是先匹配普通字符串，然后再匹配正则表达式。另外普通字符串匹配顺序是根据配置中字符长度从长到短，也就是说使用普通字符串配置的location顺序是无关紧要的，反正最后nginx会根据配置的长短来进行匹配，但是需要注意的是正则表达式按照配置文件里的顺序测试。找到第一个匹配的正则表达式将停止搜索。</span><br><span class="line"></span><br><span class="line">2.一般情况下，匹配成功了普通字符串location后还会进行正则表达式location匹配。有两种方法改变这种行为，其一就是使用“=”前缀，这时执行的是严格匹配，并且匹配成功后立即停止其他匹配，同时处理这个请求；另外一种就是使用“^~”前缀，如果把这个前缀用于一个常规字符串那么告诉nginx 如果路径匹配那么不测试正则表达式。</span><br></pre></td></tr></table></figure>



<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="selector-class">.nginx</span>匹配顺序是先匹配普通location，在匹配正则location；</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>.普通匹配规则无顺序无论写在配置文件的那个地方都一样，但是正则匹配则是按照匹配配置文件中由上到下的先后顺序匹配；</span><br></pre></td></tr></table></figure>

<h5 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(location <span class="string">`=`</span> ) &gt; (location <span class="string">`完整路径`</span> ) &gt; (location <span class="string">`^~`</span> 路径) &gt; (location <span class="string">`~`</span>,<span class="string">`~*`</span> 从上向下正则顺序，匹配在最后一条终止) &gt; (location 部分起始路径) &gt; (<span class="string">`/`</span>)</span><br></pre></td></tr></table></figure>



<p>正则表达式匹配，其中：</p>
<ul>
<li><p>~ 为区分大小写匹配</p>
</li>
<li><p>~* 为不区分大小写匹配</p>
</li>
<li><p>!<del>和!</del>*分别为区分大小写不匹配及不区分大小写不匹配</p>
<p>文件及目录匹配，其中：</p>
</li>
<li><p>-f和!-f用来判断是否存在文件</p>
</li>
<li><p>-d和!-d用来判断是否存在目录</p>
</li>
<li><p>-e和!-e用来判断是否存在文件或目录</p>
</li>
<li><p>-x和!-x用来判断文件是否可执行</p>
<p>flag标记有：</p>
</li>
<li><p>last 相当于Apache里的[L]标记，表示完成rewrite</p>
</li>
<li><p>break 终止匹配, 不再匹配后面的规则</p>
</li>
<li><p>redirect 返回302临时重定向 地址栏会显示跳转后的地址</p>
</li>
<li><p>permanent 返回301永久重定向 地址栏会显示跳转后的地址</p>
<h4 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h4><p>$args, 请求中的参数;<br>$content_length, HTTP请求信息里的”Content-Length”;<br>$content_type, 请求信息里的”Content-Type”;<br>$document_root, 针对当前请求的根路径设置值;<br>$document_uri, 与$uri相同;<br>$host, 请求信息中的”Host”，如果请求中没有Host行，则等于设置的服务器名;<br>$limit_rate, 对连接速率的限制;<br>$request_method, 请求的方法，比如”GET”、”POST”等;<br>$remote_addr, 客户端地址;<br>$remote_port, 客户端端口号;<br>$remote_user, 客户端用户名，认证用;<br>$request_filename, 当前请求的文件路径名<br>$request_body_file<br>$request_uri, 请求的URI，带查询字符串;<br>$query_string, 与$args相同;<br>$scheme, 所用的协议，比如http或者是https，比如rewrite  ^(.+)$  $scheme:&#x2F;&#x2F;example.com$1  redirect;<br>$server_protocol, 请求的协议版本，”HTTP&#x2F;1.0”或”HTTP&#x2F;1.1”;<br>$server_addr, 服务器地址，如果没有用listen指明服务器地址，使用这个变量将发起一次系统调用以取得地址(造成资源浪费);<br>$server_name, 请求到达的服务器名;<br>$server_port, 请求到达的服务器端口号;<br>$uri, 请求的URI，可能和最初的值有不同，比如经过重定向之类的。</p>
</li>
</ul>
</div><div class="article-licensing box"><div class="licensing-title"><p>Nginx知识储备</p><p><a href="https://pm123.github.io/blog/uncategorized/nginx知识储备/">https://pm123.github.io/blog/uncategorized/nginx知识储备/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>pm123</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2022-08-23</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2022-08-23</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/blog/uncategorized/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5-css%E7%9B%B8%E5%85%B3/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">记录一次线上问题排查(css相关)</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/blog/uncategorized/"><span class="level-item"> </span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><!--!--><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/blog/"><img src="/blog/img/logo.svg" alt="pm123&#039;s blog" height="28"></a><p class="is-size-7"><span>&copy; 2022 pm123</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/blog/js/column.js"></script><script src="/blog/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/blog/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/blog/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/blog/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/blog/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>